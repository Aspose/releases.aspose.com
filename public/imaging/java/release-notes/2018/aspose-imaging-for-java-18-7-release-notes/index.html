<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Aspose.Imaging for Java 18.7 - Release Notes</title><meta name=description content="Aspose.Imaging for Java 18.7 - Release Notes – the latest updates and fixes."><meta name=viewport content="width=device-width,minimum-scale=1"><link rel=canonical href=https://releases-qa.aspose.com/imaging/java/release-notes/2018/aspose-imaging-for-java-18-7-release-notes/><link rel=alternate hreflang=x-default href=https://releases-qa.aspose.com/imaging/java/release-notes/2018/aspose-imaging-for-java-18-7-release-notes/><meta name=robots content="noindex, nofollow"><link rel=apple-touch-icon sizes=180x180 href=/res_repo/apple-touch-icon.png><link rel=icon type=image/png href=/res_repo/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/res_repo/favicon-16x16.png sizes=16x16><link rel=mask-icon href=/res_repo/safari-pinned-tab.svg color=#0594cb><meta name=theme-color content="#ffffff"><meta property="og:title" content="Aspose.Imaging for Java 18.7 - Release Notes "><meta property="og:description" content="Aspose.Imaging for Java 18.7 - Release Notes – the latest updates and fixes."><meta property="og:type" content="article"><meta property="og:url" content="https://releases-qa.aspose.com/imaging/java/release-notes/2018/aspose-imaging-for-java-18-7-release-notes/"><meta itemprop=name content="Aspose.Imaging for Java 18.7 - Release Notes"><meta itemprop=description content="Aspose.Imaging for Java 18.7 - Release Notes – the latest updates and fixes."><meta itemprop=wordCount content="1842"><meta name=twitter:card content="summary"><meta name=twitter:title content="Aspose.Imaging for Java 18.7 - Release Notes"><meta name=twitter:description content="Aspose.Imaging for Java 18.7 - Release Notes – the latest updates and fixes."><link href=/css/bootstrap.css rel=stylesheet type=text/css><script src=https://releases-qa.aspose.com/res_repo/js/jquery-1.10.2.min.js></script></head><body><div id=header></div><div class=downloadpage><div class="container-fluid bcrumb1"><div id=sticky1 class=stickytopheight>&nbsp;</div><div class=container><div class=moduletable><ul id=dvBC class=breadcrumb><li><a href=/>Home</a><span class=divider></span></li><li><a href=/imaging/>Aspose.Imaging Product Family</a><span class=divider></span></li><li><a href=/imaging/java/>Aspose.Imaging for Java</a><span class=divider></span></li><li><a href=/imaging/java/release-notes/>Release Notes</a><span class=divider></span></li><li><a href=/imaging/java/release-notes/2018/>2018</a><span class=divider></span></li><li><a href=/imaging/java/release-notes/2018/aspose-imaging-for-java-18-7-release-notes/>Aspose.Imaging for Java 18.7 - Release Notes</a><span class=divider></span></li></ul></div></div></div><div class="container-fluid content2 vpanel-left"><div class=container><div class=row><div class="col-md-3 vpanel tree-section"><p class=list-title>Browse our Products<button type=button class=treeview-toggle> <span class=sr-only>Toggle navigation</span> <span class="icon expand-icon glyphicon glyphicon-hide"></span></button></p><div id=tree class="treeview hidetree"></div></div><div class="col-md-9 lhs1 col-xs-12 mobilehide node-section"><div class=box1><section role=main class="main-container page-package-details"><div class=row><div class="col-sm-9 package-details-main"><h1><strong>Aspose.Imaging for Java 18.7 - Release Notes</strong></h1><div class="tab-content body-tab-content"><div role=tabpanel class="tab-pane active" id=readme-tab><div class=readme-common><div id=readme-container><p><table><thead><tr><th style=text-align:left><strong>Key</strong></th><th style=text-align:left><strong>Summary</strong></th><th style=text-align:left><strong>Category</strong></th></tr></thead><tbody><tr><td style=text-align:left>IMAGINGJAVA-1041</td><td style=text-align:left>Support for writing SVG file for possible conversion of other formats to SVG</td><td style=text-align:left>Feature</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1030</td><td style=text-align:left>Support save Emf/Emf+ images to file</td><td style=text-align:left>Feature</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1029</td><td style=text-align:left>Lock layers in Images</td><td style=text-align:left>Feature</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1028</td><td style=text-align:left>The extraction of the ICC Profile from a gray scale image</td><td style=text-align:left>Feature</td></tr><tr><td style=text-align:left>IMAGINGJAVA-963</td><td style=text-align:left>The extraction of the ICC Profile from a gray scale image</td><td style=text-align:left>Feature</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1039</td><td style=text-align:left>Expose WebPImage properties to public</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1037</td><td style=text-align:left>SVG to JPG - scrumbled output</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1035</td><td style=text-align:left>Tiff XmpData and ExifData is not removed completely</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1034</td><td style=text-align:left>LoadArgb64Pixels causes exception without a license</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1033</td><td style=text-align:left>Fix OpenTypeFontsCache for Platform environment</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1032</td><td style=text-align:left>Investigate and fix export to JPEG2000 in multi-threaded environment</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1031</td><td style=text-align:left>The conversion GIF to PNG produces the corrupted output.</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-1007</td><td style=text-align:left>TIFF generation with embedded color profiles fails without license</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-990</td><td style=text-align:left>The alpha channel enabled by default for PSD images.</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-989</td><td style=text-align:left>ImageSaveException: Image export failed. &mdash;> java.lang.ArrayIndexOutOfBoundsException</td><td style=text-align:left>Enhancement</td></tr><tr><td style=text-align:left>IMAGINGJAVA-961</td><td style=text-align:left>The conversion of PSD file with a layer overflowing the canvas gives corrupted TIFF output</td><td style=text-align:left>Enhancement</td></tr></tbody></table><h1 id=public-api-changes><strong>Public API changes:</strong></h1><h2 id=added-apis><strong>Added APIs:</strong></h2><p>Please see corresponding cumulative <a href=/imaging/net/release-notes/2018/aspose-imaging-for-net-18-7-release-notes/>API changes for Aspose.Imaging for .Net 18.7</a> version</p><h2 id=removed-apis><strong>Removed APIs:</strong></h2><p>Please see corresponding cumulative <a href=/imaging/net/release-notes/2018/aspose-imaging-for-net-18-7-release-notes/>API changes for Aspose.Imaging for .Net 18.7</a> version</p><h1 id=usage-examples><strong>Usage examples:</strong></h1><p><strong>IMAGINGJAVA-1041 Support for writing SVG file for possible conversion of other formats to SVG</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> Image image <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;mysvg.svg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;yoursvg.svg&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-1030 Support save Emf/Emf+ images to file</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> EmfRecorderGraphics2D graphics <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> EmfRecorderGraphics2D<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>new</span> Rectangle<span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> 5000<span style=color:#f92672>,</span> 5000<span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>new</span> Size<span style=color:#f92672>(</span>5000<span style=color:#f92672>,</span> 5000<span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>new</span> Size<span style=color:#f92672>(</span>1000<span style=color:#f92672>,</span> 1000<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Font font <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Font<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Arial&#34;</span><span style=color:#f92672>,</span> 10<span style=color:#f92672>,</span> FontStyle<span style=color:#f92672>.</span><span style=color:#a6e22e>Bold</span> <span style=color:#f92672>|</span> FontStyle<span style=color:#f92672>.</span><span style=color:#a6e22e>Underline</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	graphics<span style=color:#f92672>.</span><span style=color:#a6e22e>drawString</span><span style=color:#f92672>(</span>font<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span> <span style=color:#f92672>()+</span> <span style=color:#e6db74>&#34; &#34;</span> <span style=color:#f92672>+</span> font<span style=color:#f92672>.</span><span style=color:#a6e22e>getSize</span> <span style=color:#f92672>()+</span> <span style=color:#e6db74>&#34; &#34;</span> <span style=color:#f92672>+</span> FontStyle<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(</span>FontStyle<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> font<span style=color:#f92672>.</span><span style=color:#a6e22e>getStyle</span><span style=color:#f92672>()),</span> font<span style=color:#f92672>,</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>getBrown</span><span style=color:#f92672>(),</span> 10<span style=color:#f92672>,</span> 10<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	graphics<span style=color:#f92672>.</span><span style=color:#a6e22e>drawString</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;some text&#34;</span><span style=color:#f92672>,</span> font<span style=color:#f92672>,</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>getBrown</span><span style=color:#f92672>(),</span> 10<span style=color:#f92672>,</span> 30<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	font <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Font<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Arial&#34;</span><span style=color:#f92672>,</span> 24<span style=color:#f92672>,</span> FontStyle<span style=color:#f92672>.</span><span style=color:#a6e22e>Italic</span> <span style=color:#f92672>|</span> FontStyle<span style=color:#f92672>.</span><span style=color:#a6e22e>Strikeout</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	graphics<span style=color:#f92672>.</span><span style=color:#a6e22e>drawString</span><span style=color:#f92672>(</span>font<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span> <span style=color:#f92672>()+</span> <span style=color:#e6db74>&#34; &#34;</span> <span style=color:#f92672>+</span> font<span style=color:#f92672>.</span><span style=color:#a6e22e>getSize</span> <span style=color:#f92672>()+</span> <span style=color:#e6db74>&#34; &#34;</span> <span style=color:#f92672>+</span> FontStyle<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(</span>FontStyle<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> font<span style=color:#f92672>.</span><span style=color:#a6e22e>getStyle</span><span style=color:#f92672>()),</span> font<span style=color:#f92672>,</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>getBrown</span><span style=color:#f92672>(),</span> 20<span style=color:#f92672>,</span> 50<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	graphics<span style=color:#f92672>.</span><span style=color:#a6e22e>drawString</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;some text&#34;</span><span style=color:#f92672>,</span> font<span style=color:#f92672>,</span> Color<span style=color:#f92672>.</span><span style=color:#a6e22e>getBrown</span><span style=color:#f92672>(),</span> 20<span style=color:#f92672>,</span> 80<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	EmfImage image <span style=color:#f92672>=</span> graphics<span style=color:#f92672>.</span><span style=color:#a6e22e>endRecording</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		String path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Fonts.emf&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>path<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> EmfOptions<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>String path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;TestEmfPlusFigures.emf&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>EmfImage image <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>EmfImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>path<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>path <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.emf&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> EmfOptions<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;TestEmfBezier.emf&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>image <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>EmfImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>path<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>path <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.emf&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> EmfOptions<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span> </span></span></code></pre></div><p><strong>IMAGINGJAVA-1029 Lock layers in Images</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> String sourceFile <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;layerLock.psd&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>String outputFile <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;result.psd&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PsdImage image <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>PsdImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>sourceFile<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Layer<span style=color:#f92672>[]</span> layers <span style=color:#f92672>=</span> image<span style=color:#f92672>.</span><span style=color:#a6e22e>getLayers</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	layers<span style=color:#f92672>[</span>4<span style=color:#f92672>].</span><span style=color:#a6e22e>setLayerLock</span><span style=color:#f92672>(</span>LayerLockType<span style=color:#f92672>.</span><span style=color:#a6e22e>LockAll</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	layers<span style=color:#f92672>[</span>2<span style=color:#f92672>].</span><span style=color:#a6e22e>setLayerLock</span><span style=color:#f92672>(</span>LayerLockType<span style=color:#f92672>.</span><span style=color:#a6e22e>None</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	layers<span style=color:#f92672>[</span>3<span style=color:#f92672>].</span><span style=color:#a6e22e>setLayerLock</span><span style=color:#f92672>(</span>LayerLockType<span style=color:#f92672>.</span><span style=color:#a6e22e>LockTransparentPixels</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	layers<span style=color:#f92672>[</span>1<span style=color:#f92672>].</span><span style=color:#a6e22e>setLayerLock</span><span style=color:#f92672>(</span>LayerLockType<span style=color:#f92672>.</span><span style=color:#a6e22e>LockImagePixels</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	layers<span style=color:#f92672>[</span>5<span style=color:#f92672>].</span><span style=color:#a6e22e>setLayerLock</span><span style=color:#f92672>(</span>LayerLockType<span style=color:#f92672>.</span><span style=color:#a6e22e>LockPosition</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	layers<span style=color:#f92672>[</span>5<span style=color:#f92672>].</span><span style=color:#a6e22e>setFlags</span><span style=color:#f92672>(</span>LayerFlags<span style=color:#f92672>.</span><span style=color:#a6e22e>TransparencyProtected</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>outputFile<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-1028 The extraction of the ICC Profile from a gray scale image</strong></p><p>There is a new property PsdImage.GrayColorProfile to extract Gray (monochrome) ICC profile from PSD image.
I wrote only the code to extract the Gray ICC profile intact.
For now, the Gray ICC profile is not applied to the color data when it is loaded from PSD, so color conversion doesn&rsquo;t take place, only extraction does.
The code to get grayscale TIFF with ICC profile from grayscale PSD with ICC profile may look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testJira2990_ExtractIccProfiles</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C:\\Errors\\IMAGINGJAVA-1028\\&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	PsdImage psdImage <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>PsdImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>//StreamSource cmykProfile = psdImage.CmykColorProfile;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>//StreamSource rgbProfile = psdImage.RgbColorProfile;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		StreamSource grayProfile <span style=color:#f92672>=</span> psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>getGrayColorProfile</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Save to grayscale TIFF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		TiffOptions saveOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TiffOptions<span style=color:#f92672>(</span>TiffExpectedFormat<span style=color:#f92672>.</span><span style=color:#a6e22e>Default</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setPhotometric</span><span style=color:#f92672>(</span>TiffPhotometrics<span style=color:#f92672>.</span><span style=color:#a6e22e>MinIsBlack</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setBitsPerSample</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> <span style=color:#f92672>{</span> 8 <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// No ICC profile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd.noprofile.tif&#34;</span><span style=color:#f92672>,</span> saveOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Embed ICC profile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setIccProfile</span><span style=color:#f92672>(</span>toMemoryStream<span style=color:#f92672>(</span>grayProfile<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd.tif&#34;</span><span style=color:#f92672>,</span> saveOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> <span style=color:#a6e22e>toMemoryStream</span><span style=color:#f92672>(</span>StreamSource streamSource<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	StreamContainer sc <span style=color:#f92672>=</span> streamSource<span style=color:#f92672>.</span><span style=color:#a6e22e>getStreamContainer</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> sc<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytes</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		sc<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><em>Please use the following code to extract Gray (monochrome) ICC profile from PSD image and embed it to TIFF image.</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testJira2990_ExtractIccProfiles_ApplyIcc</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C:\\Errors\\IMAGINGJAVA-1028\\&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String sourcePath <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String outputPath <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd.apply-icc.tif&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Save to grayscale TIFF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	TiffOptions saveOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TiffOptions<span style=color:#f92672>(</span>TiffExpectedFormat<span style=color:#f92672>.</span><span style=color:#a6e22e>Default</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setPhotometric</span><span style=color:#f92672>(</span>TiffPhotometrics<span style=color:#f92672>.</span><span style=color:#a6e22e>MinIsBlack</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setBitsPerSample</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> <span style=color:#f92672>{</span> 8 <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If the image contains a built-in Gray ICC profile, it is not be applied by default in contrast of the CMYK profile.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Enable ICC conversion explicitly.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	LoadOptions loadOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LoadOptions<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	loadOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setUseIccProfileConversion</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	PsdImage psdImage <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>PsdImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>sourcePath<span style=color:#f92672>,</span> loadOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Embed the gray ICC profile to the output TIFF.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// The built-in Gray Profile can be read via the PsdImage.GrayColorProfile property.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setIccProfile</span><span style=color:#f92672>(</span>toMemoryStream<span style=color:#f92672>(</span>psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>getGrayColorProfile</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>outputPath<span style=color:#f92672>,</span> saveOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> <span style=color:#a6e22e>toMemoryStream</span><span style=color:#f92672>(</span>StreamSource streamSource<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	StreamContainer sc <span style=color:#f92672>=</span> streamSource<span style=color:#f92672>.</span><span style=color:#a6e22e>getStreamContainer</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> sc<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytes</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		sc<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><em>You can also set loadOptions.UseIccProfileConversion = false to disable ICC color conversion explicitly as shown below:</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testJira2990_ExtractIccProfiles_IgnoreIcc</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C:\\Temp\\Errors\\IMAGINGJAVA-1028\\&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String sourcePath <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String outputPath <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd.ignore-icc.tif&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Save to grayscale TIFF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	TiffOptions saveOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TiffOptions<span style=color:#f92672>(</span>TiffExpectedFormat<span style=color:#f92672>.</span><span style=color:#a6e22e>Default</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setPhotometric</span><span style=color:#f92672>(</span>TiffPhotometrics<span style=color:#f92672>.</span><span style=color:#a6e22e>MinIsBlack</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setBitsPerSample</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> <span style=color:#f92672>{</span> 8 <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If the image contains a built-in Gray ICC profile, it is not be applied by default in contrast of the CMYK profile.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Enable ICC conversion explicitly.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	LoadOptions loadOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LoadOptions<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	loadOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setUseIccProfileConversion</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	PsdImage psdImage <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>PsdImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>sourcePath<span style=color:#f92672>,</span> loadOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Embed the gray ICC profile to the output TIFF.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// The built-in Gray Profile can be read via the PsdImage.GrayColorProfile property.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setIccProfile</span><span style=color:#f92672>(</span>toMemoryStream<span style=color:#f92672>(</span>psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>getGrayColorProfile</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>outputPath<span style=color:#f92672>,</span> saveOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-963 The extraction of the ICC Profile from a gray scale image</strong></p><p>There is a new property PsdImage.GrayColorProfile to extract Gray (monochrome) ICC profile from PSD image.
I wrote only the code to extract the Gray ICC profile intact.
For now, the Gray ICC profile is not applied to the color data when it is loaded from PSD, so color conversion doesn&rsquo;t take place, only extraction does.
The code to get grayscale TIFF with ICC profile from grayscale PSD with ICC profile may look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testJira2990_ExtractIccProfiles</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C:\\Errors\\IMAGINGJAVA-1028\\&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	PsdImage psdImage <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>PsdImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>//StreamSource cmykProfile = psdImage.CmykColorProfile;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>//StreamSource rgbProfile = psdImage.RgbColorProfile;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		StreamSource grayProfile <span style=color:#f92672>=</span> psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>getGrayColorProfile</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Save to grayscale TIFF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		TiffOptions saveOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TiffOptions<span style=color:#f92672>(</span>TiffExpectedFormat<span style=color:#f92672>.</span><span style=color:#a6e22e>Default</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setPhotometric</span><span style=color:#f92672>(</span>TiffPhotometrics<span style=color:#f92672>.</span><span style=color:#a6e22e>MinIsBlack</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setBitsPerSample</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> <span style=color:#f92672>{</span> 8 <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// No ICC profile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd.noprofile.tif&#34;</span><span style=color:#f92672>,</span> saveOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Embed ICC profile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setIccProfile</span><span style=color:#f92672>(</span>toMemoryStream<span style=color:#f92672>(</span>grayProfile<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd.tif&#34;</span><span style=color:#f92672>,</span> saveOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> <span style=color:#a6e22e>toMemoryStream</span><span style=color:#f92672>(</span>StreamSource streamSource<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	StreamContainer sc <span style=color:#f92672>=</span> streamSource<span style=color:#f92672>.</span><span style=color:#a6e22e>getStreamContainer</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> sc<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytes</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		sc<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><em>Please use the following code to extract Gray (monochrome) ICC profile from PSD image and embed it to TIFF image.</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testJira2990_ExtractIccProfiles_ApplyIcc</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C:\\Errors\\IMAGINGJAVA-1028\\&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String sourcePath <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String outputPath <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd.apply-icc.tif&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Save to grayscale TIFF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	TiffOptions saveOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TiffOptions<span style=color:#f92672>(</span>TiffExpectedFormat<span style=color:#f92672>.</span><span style=color:#a6e22e>Default</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setPhotometric</span><span style=color:#f92672>(</span>TiffPhotometrics<span style=color:#f92672>.</span><span style=color:#a6e22e>MinIsBlack</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setBitsPerSample</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> <span style=color:#f92672>{</span> 8 <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If the image contains a built-in Gray ICC profile, it is not be applied by default in contrast of the CMYK profile.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Enable ICC conversion explicitly.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	LoadOptions loadOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LoadOptions<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	loadOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setUseIccProfileConversion</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	PsdImage psdImage <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>PsdImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>sourcePath<span style=color:#f92672>,</span> loadOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Embed the gray ICC profile to the output TIFF.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// The built-in Gray Profile can be read via the PsdImage.GrayColorProfile property.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setIccProfile</span><span style=color:#f92672>(</span>toMemoryStream<span style=color:#f92672>(</span>psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>getGrayColorProfile</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>outputPath<span style=color:#f92672>,</span> saveOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> <span style=color:#a6e22e>toMemoryStream</span><span style=color:#f92672>(</span>StreamSource streamSource<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	StreamContainer sc <span style=color:#f92672>=</span> streamSource<span style=color:#f92672>.</span><span style=color:#a6e22e>getStreamContainer</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> sc<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytes</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		sc<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><em>You can also set loadOptions.UseIccProfileConvijersion = false to disable ICC color conversion explicitly as shown below:</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testJira2990_ExtractIccProfiles_IgnoreIcc</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C:\\Temp\\Errors\\IMAGINGJAVA-1028\\&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String sourcePath <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String outputPath <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;gray-d15.psd.ignore-icc.tif&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Save to grayscale TIFF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	TiffOptions saveOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TiffOptions<span style=color:#f92672>(</span>TiffExpectedFormat<span style=color:#f92672>.</span><span style=color:#a6e22e>Default</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setPhotometric</span><span style=color:#f92672>(</span>TiffPhotometrics<span style=color:#f92672>.</span><span style=color:#a6e22e>MinIsBlack</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setBitsPerSample</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> <span style=color:#f92672>{</span> 8 <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If the image contains a built-in Gray ICC profile, it is not be applied by default in contrast of the CMYK profile.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Enable ICC conversion explicitly.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	LoadOptions loadOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LoadOptions<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	loadOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setUseIccProfileConversion</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	PsdImage psdImage <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>PsdImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>sourcePath<span style=color:#f92672>,</span> loadOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Embed the gray ICC profile to the output TIFF.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// The built-in Gray Profile can be read via the PsdImage.GrayColorProfile property.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>		saveOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setIccProfile</span><span style=color:#f92672>(</span>toMemoryStream<span style=color:#f92672>(</span>psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>getGrayColorProfile</span><span style=color:#f92672>()));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>outputPath<span style=color:#f92672>,</span> saveOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		psdImage<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-1039 Expose WebPImage properties to public</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> String animFileName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Animation1.webp&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>String animPathReSavedOptions <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Animation1_reSavedOptions.webp&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WebPOptions options <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> WebPOptions<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>options<span style=color:#f92672>.</span><span style=color:#a6e22e>setQuality</span><span style=color:#f92672>(</span>90f<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>options<span style=color:#f92672>.</span><span style=color:#a6e22e>setAnimLoopCount</span><span style=color:#f92672>(</span>5<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>options<span style=color:#f92672>.</span><span style=color:#a6e22e>setAnimBackgroundColor</span><span style=color:#f92672>(</span>Color<span style=color:#f92672>.</span><span style=color:#a6e22e>getGray</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toArgb</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>options<span style=color:#f92672>.</span><span style=color:#a6e22e>setLossless</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WebPImage image <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>WebPImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>animFileName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>assertEquals</span><span style=color:#f92672>(</span>4278190080L<span style=color:#f92672>,</span> image<span style=color:#f92672>.</span><span style=color:#a6e22e>getOptions</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getAnimBackgroundColor</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>assertEquals</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> image<span style=color:#f92672>.</span><span style=color:#a6e22e>getOptions</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getAnimLoopCount</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>animPathReSavedOptions<span style=color:#f92672>,</span> options<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WebPImage reSavedOptions <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>WebPImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>animPathReSavedOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>assertEquals</span><span style=color:#f92672>(</span>reSavedOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>getOptions</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getAnimBackgroundColor</span><span style=color:#f92672>(),</span> options<span style=color:#f92672>.</span><span style=color:#a6e22e>getAnimBackgroundColor</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>assertEquals</span><span style=color:#f92672>(</span>reSavedOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>getOptions</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getAnimLoopCount</span><span style=color:#f92672>(),</span> options<span style=color:#f92672>.</span><span style=color:#a6e22e>getAnimLoopCount</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>assertEquals</span><span style=color:#f92672>(</span>reSavedOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>getOptions</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getLossless</span><span style=color:#f92672>(),</span> options<span style=color:#f92672>.</span><span style=color:#a6e22e>getLossless</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	reSavedOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-1037 SVG to JPG - scrumbled output</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> String fileDir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;D:\\IMAGINGJAVA_1037\\&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>String<span style=color:#f92672>[]</span> files <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;Abu_Dhabi_Media.svg&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;az-alkmaar.svg&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>};</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>String fileName <span style=color:#f92672>:</span> files<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String inputFileName <span style=color:#f92672>=</span> fileDir <span style=color:#f92672>+</span> fileName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String outputFileName <span style=color:#f92672>=</span> inputFileName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.jpg&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Image image <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>inputFileName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		JpegOptions options <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> JpegOptions<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>outputFileName<span style=color:#f92672>,</span> options<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-1034 LoadArgb64Pixels causes exception without a license</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> String dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C:\\Errors\\1006\\&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>String fileName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;16bit Uncompressed, BigEndian, Rgb, Contiguous Gamma1.0.tif&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ICC profile is not applied for 16-bit color components at the moment, so disable that option explicitly.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>LoadOptions loadOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LoadOptions<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>loadOptions<span style=color:#f92672>.</span><span style=color:#a6e22e>setUseIccProfileConversion</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Rectangle desiredArea <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Rectangle<span style=color:#f92672>(</span>470<span style=color:#f92672>,</span> 1350<span style=color:#f92672>,</span> 30<span style=color:#f92672>,</span> 30<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RasterImage image <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>RasterImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>dir <span style=color:#f92672>+</span> fileName<span style=color:#f92672>,</span> loadOptions<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>long</span><span style=color:#f92672>[]</span> colors64Bit <span style=color:#f92672>=</span> image<span style=color:#f92672>.</span><span style=color:#a6e22e>loadArgb64Pixels</span><span style=color:#f92672>(</span>image<span style=color:#f92672>.</span><span style=color:#a6e22e>getBounds</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>int</span> alpha<span style=color:#f92672>,</span> red<span style=color:#f92672>,</span> green<span style=color:#f92672>,</span> blue<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> y <span style=color:#f92672>=</span> desiredArea<span style=color:#f92672>.</span><span style=color:#a6e22e>getTop</span><span style=color:#f92672>();</span> y <span style=color:#f92672>&lt;</span> desiredArea<span style=color:#f92672>.</span><span style=color:#a6e22e>getBottom</span><span style=color:#f92672>();</span> <span style=color:#f92672>++</span>y<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> desiredArea<span style=color:#f92672>.</span><span style=color:#a6e22e>getLeft</span><span style=color:#f92672>();</span> x <span style=color:#f92672>&lt;</span> desiredArea<span style=color:#f92672>.</span><span style=color:#a6e22e>getRight</span><span style=color:#f92672>();</span> <span style=color:#f92672>++</span>x<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>int</span> offset <span style=color:#f92672>=</span> y <span style=color:#f92672>*</span> image<span style=color:#f92672>.</span><span style=color:#a6e22e>getWidth</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> x<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>long</span> color64 <span style=color:#f92672>=</span> colors64Bit<span style=color:#f92672>[</span>offset<span style=color:#f92672>];</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			alpha <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>)((</span>color64 <span style=color:#f92672>&gt;&gt;</span> 48<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;</span> 0xffff<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			red <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>)((</span>color64 <span style=color:#f92672>&gt;&gt;</span> 32<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;</span> 0xffff<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			green <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>)((</span>color64 <span style=color:#f92672>&gt;&gt;</span> 16<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;</span> 0xffff<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			blue <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>)(</span>color64 <span style=color:#f92672>&amp;</span> 0xffff<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>format</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;A=%X, R=%X, G=%X, B=%X\n&#34;</span><span style=color:#f92672>,</span> alpha<span style=color:#f92672>,</span> red<span style=color:#f92672>,</span> green<span style=color:#f92672>,</span> blue<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-1032 Investigate and fix export to JPEG2000 in multi-threaded environment</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String<span style=color:#f92672>[]</span> inputFiles <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;tiger.bmp&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;ImagePaletteColor.dicom&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;2086.gif&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;10.jpg&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;multi.jpx&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;1.png&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;3layers_maximized_comp.psd&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;33266.tif&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;Animation1.webp&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>};</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> StringBuilder stackTrace <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StringBuilder<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> isError <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// this method should throw no exceptions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testSaveJpeg2000Multithreaded</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> InterruptedException
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Thread<span style=color:#f92672>[]</span> threads <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>[</span>inputFiles<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>];</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> x <span style=color:#f92672>&lt;</span> inputFiles<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>;</span> x<span style=color:#f92672>++)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>final</span> String inputFile <span style=color:#f92672>=</span> inputFiles<span style=color:#f92672>[</span>x<span style=color:#f92672>];</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		threads<span style=color:#f92672>[</span>x<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Runnable<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>							<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>							<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>								saveAsJpeg2000<span style=color:#f92672>(</span>inputFile<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>							<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		threads<span style=color:#f92672>[</span>x<span style=color:#f92672>].</span><span style=color:#a6e22e>start</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Thread thread <span style=color:#f92672>:</span> threads<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		thread<span style=color:#f92672>.</span><span style=color:#a6e22e>join</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>isError</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>stackTrace<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>saveAsJpeg2000</span><span style=color:#f92672>(</span>String inputFile<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	String outFile <span style=color:#f92672>=</span> inputFile <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.jp2&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Image img <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>inputFile<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			img<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>outFile<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> Jpeg2000Options<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>isError</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			stackTrace<span style=color:#f92672>.</span><span style=color:#a6e22e>append</span><span style=color:#f92672>(</span>e<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		img<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	File f <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>outFile<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	f<span style=color:#f92672>.</span><span style=color:#a6e22e>delete</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-1031 The conversion GIF to PNG produces the corrupted output.</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> String sourceFileName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;source.GIF&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>String outputFileName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;output.png&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Image image <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>sourceFileName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>outputFileName<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> PngOptions<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-1007 TIFF generation with embedded color profiles fails without license</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#75715e>// Reset license to Evaluated
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>License lic <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> License<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lic<span style=color:#f92672>.</span><span style=color:#a6e22e>setLicense</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>String fileName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;NavyExchangeCmyk.psd&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PsdImage image <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>PsdImage<span style=color:#f92672>)</span>Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>fileName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>setUseRawData</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	TiffOptions options <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TiffOptions<span style=color:#f92672>(</span>TiffExpectedFormat<span style=color:#f92672>.</span><span style=color:#a6e22e>TiffLzwCmyk</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>image<span style=color:#f92672>.</span><span style=color:#a6e22e>getCmykColorProfile</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		StreamContainer icc <span style=color:#f92672>=</span> image<span style=color:#f92672>.</span><span style=color:#a6e22e>getCmykColorProfile</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getStreamContainer</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			options<span style=color:#f92672>.</span><span style=color:#a6e22e>setIccProfile</span><span style=color:#f92672>(</span>icc<span style=color:#f92672>.</span><span style=color:#a6e22e>toBytes</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			icc<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>fileName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.NoLic.tif&#34;</span><span style=color:#f92672>,</span> options<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><p><strong>IMAGINGJAVA-990 The alpha channel enabled by default for PSD images</strong>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> String dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C:\\Errors\\IMAGINGJAVA-990\\&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>String sourceFileName <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;alphachannel.psd&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>String outputFileName <span style=color:#f92672>=</span> dir <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;result.jpg&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PsdImage image <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>PsdImage<span style=color:#f92672>)</span> Image<span style=color:#f92672>.</span><span style=color:#a6e22e>load</span><span style=color:#f92672>(</span>sourceFileName<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>								<span style=color:#66d9ef>new</span> PsdLoadOptions<span style=color:#f92672>()</span> <span style=color:#f92672>{{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>									setReadOnlyMode<span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>									setIgnoreAlphaChannel<span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>								<span style=color:#f92672>}});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>outputFileName<span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> JpegOptions<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	image<span style=color:#f92672>.</span><span style=color:#a6e22e>dispose</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div></p></div></div></div></div><hr></div></div></section></div></div></div></div></div></div><div id=dvHidden style=display:none></div><div id=footer></div><a class=backtop>&nbsp;</a><div id=DynabicMenuFooter></div><script type=text/javascript>const langarray=[]</script><script type=text/javascript>jQuery(document).ready(function(){let e=$(".nested").hide(),t=$(".treeview-animated-element");$(".treeview-animated-items-header").hover(function(){$(this).children.toggleClass("Mydiv")}),$(".treeview-animated-items-header").click(function(){return console.log("mala"),$this=$(this),console.log($this.attr("id")),$target=$this.siblings(".nested"),$pointerPlus=$this.children(".fa-plus"),$pointerMinus=$this.children(".fa-minus"),$pointerPlus.removeClass("fa-plus"),$pointerPlus.addClass("fa-minus"),$pointerMinus.removeClass("fa-minus"),$pointerMinus.addClass("fa-plus"),$this.toggleClass("open"),$target.hasClass("active")?$target.removeClass("active").slideUp():$target.addClass("active").slideDown(),!1})})</script><script>(function(e,s,o,a,t,n,i){e.ContainerizeMenuObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=s.createElement(o),i=s.getElementsByTagName(o)[0],n.async=1,n.src=a,i.parentNode.append(n)})(window,document,"script","https://menu.containerize.com/scripts/engine.min.js?v=1.0.1","aspose-en")</script><script src=https://releases-qa.aspose.com/res_repo/js/highlight.min.js></script>
<script src=https://releases-qa.aspose.com/res_repo/js/bootstrap.min.js></script>
<script src=/js/bundle.min.js></script>
<script src=/js/dynabic.treeview.js></script>
<script src=/js/treeviewmanager.js></script>
<script>hljs.highlightAll()</script><link rel=stylesheet type=text/css href=https://releases-qa.aspose.com/res_repo/css/hugocustom.css><script>$(".btn-showside .mb-5").on("click",function(){$("main .flex .dn.db-l").toggleClass("showsidebar"),$("main .flex .w-100").toggleClass("noscroll")}),$(".btn-showmenu").on("click",function(){$("nav.bg-primary-color-dark").toggleClass("showmenu")}),$(".btn-plain").on("click",function(){$("main .flex .dn.db-l").removeClass("showsidebar"),$("main .flex .dn.db-l").removeClass("showsidebar"),$("nav.bg-primary-color-dark").removeClass("showmenu")}),$(".ss-bar ul li a[data-target]").on("click",function(){$(this).find(".i.fa-angle-down").hasClass("fa-angle-up")?$(this).find("i.fa-angle-down").removeClass("fa-angle-up"):$(this).find("i.fa-angle-down").toggleClass("fa-angle-up")}),$(".btn-showside").on("click",function(){$(".ss-bar").toggleClass("showsidebar")}),$(".btn-plain").on("click",function(){$(".ss-bar").removeClass("showsidebar")})</script><script>$(document).ready(function(){$("div pre").removeAttr("style");var e,t=$(location).attr("hash");"#package-explorer"==t&&(e=document.querySelector('.nav-tabs a[href="#packageexplorer-tab"]'),e&&e.click()),$('a:has(img[alt="banner"]').click(function(){event.preventDefault();var e=document.querySelector('.nav-tabs a[href="#packageexplorer-tab"]');e&&e.click()}),$(window).scroll(function(){$(this).scrollTop()>150?$(".backtop").fadeIn():$(".backtop").fadeOut()}),$(".backtop").click(function(){return $("html, body").animate({scrollTop:0},600),!1}),$(".linkshow").on("click",function(){$(this).find("i").toggleClass("fa-minus-square"),$(".linkshowbox").toggleClass("hide")}),document.querySelector("body").addEventListener("click",function(t){if(t.target.classList.contains("searchButton")){$(".ss-bar").removeClass("showsidebar");try{var e=$("input[name=q]").val();gtag("config","UA-3109235-2",{page_path:"/search/?q="+e})}catch(e){}}if(t.target.classList.contains("fa-search")){$(".ss-bar").removeClass("showsidebar");try{e=$("input[name=q]").val(),gtag("config","UA-3109235-2",{page_path:"/search/?q="+e})}catch(e){}}},!0)})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>